"use strict";!function(e){"function"==typeof define&&define.amd?define("JOII",[],e):e("object"==typeof exports?exports:window)}(function(e){var t="undefined"!=typeof e.JOII?e.JOII:{};t="undefined"!=typeof t?t:{},t.Compat={},t.Compat.findJOIIName=function(e){var n,i;if("string"==typeof e||"number"==typeof e||"undefined"==typeof e||null===e)return!1;if("undefined"!=typeof e.__joii__)return e.__joii__.name;if("undefined"!=typeof e.prototype&&"undefined"!=typeof e.prototype.__joii__)return e.prototype.__joii__.name;if("undefined"!=typeof e.__proto__&&(i=t.Compat.findJOIIName(e.__proto__),"string"==typeof i))return i;"function"==typeof e&&(e=e.prototype);for(n in e)if(e.hasOwnProperty(n)!==!1&&("function"==typeof e[n]||"object"==typeof e[n])&&(i=t.Compat.findJOIIName(e[n]),"string"==typeof i))return i;return!1},t.Compat.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);var n=e.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),i=0>i?i+n:i;n>i;i++)if(i in e&&e[i]===t)return i;return-1},t.Compat.extend=function(){var e,n,i,a,r=!1,o=arguments[0]||{},s=1,f=arguments.length,p=!1;for("boolean"==typeof o&&(p=o,o=arguments[s]||{},s++),"object"!=typeof o&&"function"!=typeof o&&(o={});f>s;s++)if(e=arguments[s],null!==e&&void 0!==arguments[s]){"undefined"!=typeof e.__joii__&&t.CreateProperty(o,"__joii__",e.__joii__);for(var l in e)n=o[l],i=e[l],o!==i&&(p&&i&&(t.Compat.isPlainObject(i)||(r=t.Compat.isArray(i)))?(r?(r=!1,a=n&&t.Compat.isArray(n)?n:[]):a=n&&t.Compat.isPlainObject(n)?n:{},o[l]=t.Compat.extend(p,a,i)):void 0!==i&&(o[l]=i))}return o},t.Compat.isArray=function(e){var t=e.length,n=typeof e;return"function"===n||"undefined"!=typeof window&&e===window?!1:1===e.nodeType&&t?!0:"[object Array]"===Object.prototype.toString.call(e)},t.Compat.isPlainObject=function(e){var t={}.hasOwnProperty;return"object"!=typeof e||e.nodeType||"undefined"!=typeof window&&e===window?!1:!(e.constructor&&!t.call(e.constructor.prototype,"isPrototypeOf"))},t.Compat.CreateObject=function(e){if("function"==typeof Object.create)return Object.create(e);var t=function(){function e(){}return function(t){if(1!=arguments.length)throw new Error("JOII.Compat.CreateObject implementation only accepts one parameter.");return e.prototype=t,new e}}();return t(e)},t.Compat.Bind=function(e,t){if("function"!=typeof e)throw new TypeError("Function.prototype.bind - argument #1 must be a function.");return function(){return e.apply(t,arguments)}},t.Compat.GenerateUUID=function(){for(var e=[],t="0123456789abcdef",n=0;36>n;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},t.Compat.ParseArguments=function(e){var n={name:"",parameters:{},body:{}};switch(e.length){case 0:n.name=t.Compat.GenerateUUID();break;case 1:"string"==typeof e[0]&&(n.name=e[0]),"object"==typeof e[0]&&(n.name=t.Compat.GenerateUUID(),n.body=e[0]);break;case 2:"string"==typeof e[0]&&(n.name=e[0]),"object"==typeof e[0]&&(n.name=t.Compat.GenerateUUID(),n.parameters=e[0]),n.body=e[1];break;case 3:n.name=e[0],n.parameters=e[1],n.body=e[2]}if("string"!=typeof n.name||"object"!=typeof n.parameters||"object"!=typeof n.body)throw"Invalid parameter types given. Expected: ([[[string], object], <object>]).";return n},t.Compat.flexibleArgumentToArray=function(e,n){if("object"!=typeof e||t.Compat.isArray(e)||"undefined"!=typeof e[0]){if("function"==typeof e)return[n?t.Compat.extend(!0,{},e.prototype):e.prototype];if("object"==typeof e&&t.Compat.isArray(e)){var i=[];for(var a in e)i.push(t.Compat.flexibleArgumentToArray(e[a],!1)[0]);return i}throw"Unable to read "+typeof e+". Object, function or array expected."}return[n?t.Compat.extend(!0,{},e):e]},t.Compat.canTypeBeCastTo=function(e,n){if("undefined"!=typeof t.InterfaceRegistry[n]||"undefined"!=typeof t.ClassRegistry[n]){if(t.Compat.findJOIIName(e)!==n&&null!==e&&("function"!=typeof e.instanceOf||"object"==typeof e&&"function"==typeof e.instanceOf&&!e.instanceOf(n)))return!1}else if("undefined"!=typeof t.EnumRegistry[n]){var i=t.EnumRegistry[n];if(!i.contains(e))return!1}else if(typeof e!==n)return!1;return!0},t="undefined"!=typeof t?t:{},t.Config={constructors:["__construct","construct","->","=>"],callables:["__call","<>"],addConstructor:function(e){-1===t.Config.constructors.indexOf(e)&&t.Config.constructors.push(e)},removeConstructor:function(e){-1!==t.Config.constructors.indexOf(e)&&t.Config.constructors.splice(t.Config.constructors.indexOf(e),1)},addCallable:function(e){-1===t.Config.callables.indexOf(e)&&t.Config.callables.push(e)},removeCallable:function(e){-1!==t.Config.callables.indexOf(e)&&t.Config.callables.splice(t.Config.callables.indexOf(e),1)}},t="undefined"!=typeof t?t:{},t.InternalPropertyNames=["__joii__","super","instanceOf","deserialize","serialize"],t.InternalTypeNames=["undefined","object","boolean","number","string","symbol","function","const"],t.PrototypeBuilder=function(e,n,i,a){var r={},o=t.Compat.extend(!0,{},i);if(t.CreateProperty(r,"__joii__",{name:e,parent:void 0,metadata:{},constants:{},implementations:[e],is_abstract:n["abstract"]===!0,is_final:n["final"]===!0}),"undefined"!=typeof n.uses){var s=t.Compat.flexibleArgumentToArray(n.uses);for(var f in s)o=t.Compat.extend(!0,o,s[f])}if(r.__joii__.is_abstract&&r.__joii__.is_final)throw"A class cannot be both abstract and final simultaniously.";for(var p in o)if(o.hasOwnProperty(p)!==!1){var l=t.ParseClassProperty(p);if("function"==typeof o[p]||l.parameters.length>0||l.name in r.__joii__.metadata&&"overloads"in r.__joii__.metadata[l.name]){if("function"!=typeof o[p])throw l.parameters.length>0?"Member "+l.name+" specifies parameters, but it's value isn't a function.":"Member "+l.name+" overloads an existing function, but it's value isn't a function.";if(l.name in r&&"function"!=typeof r[l.name])throw"Member "+l.name+" overloads an existing property, but the previous property isn't a function.";t.AddFunctionToPrototype(r,l,o[p])}else l.is_constant?(r.__joii__.constants[l.name]=o[p],t.CreateProperty(r,l.name,o[p],!1),r.__joii__.metadata[l.name]=l):(r[l.name]=o[p],r.__joii__.metadata[l.name]=l)}if("undefined"!=typeof n["abstract"]&&(r.__joii__.is_abstract=!0,a))throw"An interface cannot be declared abstract.";if("undefined"!=typeof n["extends"]){var c=n["extends"];if("function"==typeof c&&(c=c.prototype),"object"!=typeof c)throw(a?"An interface":"A class")+" may only extend on functions or object-types.";if(r.__joii__.parent=t.Compat.extend(!0,{},c),c.__joii__.is_final===!0)throw"Unable to extend on a final class.";for(var _=r.__joii__.parent;"undefined"!=typeof _;)r.__joii__.implementations.push(_.__joii__.name),_=_.__joii__.parent;r.__joii__.constants=t.Compat.extend(!0,r.__joii__.constants,c.__joii__.constants),t.CreateProperty(r.__joii__.parent,"__joii__",c.__joii__);for(p in r.__joii__.parent)if(r.__joii__.parent.hasOwnProperty(p)&&-1===t.Compat.indexOf(t.InternalPropertyNames,p)){var u=r.__joii__.parent[p],m=r.__joii__.parent.__joii__.metadata[p],d=r.__joii__.metadata[p];if("undefined"==typeof d&&(d=r.__joii__.metadata[p]=t.Compat.extend(!0,{},m),"overloads"in d&&delete d.overloads),"undefined"!=typeof r[p]&&"object"==typeof m&&"object"==typeof d){if(d.is_generated===!1){if(m.visibility!==d.visibility)throw'Member "'+p+'" must be '+m.visibility+" as defined in the parent "+(a?"interface":"class")+".";if(m.is_final===!0)throw'Final member "'+p+'" cannot be overwritten.';if(m.is_read_only!==d.is_read_only)throw'Member "'+p+'" must be read-only as defined in the parent '+(a?"interface":"class")+".";if(m.is_nullable!==d.is_nullable)throw'Member "'+p+'" must be nullable as defined in the parent '+(a?"interface":"class")+"."}if(!("function"==typeof u||m.parameters.length>0||"overloads"in d||"overloads"in m))continue}if("function"==typeof u||m.parameters.length>0||"overloads"in d||"overloads"in m);else if("function"!=typeof u||a===!0){r[p]=u;var y=t.CreatePropertyGetterSetter(r,m);"undefined"==typeof r[y.getter.name]&&"undefined"!=typeof y.getter.meta&&(y.getter.meta.is_generated=!0,r[y.getter.name]=y.getter.fn,r.__joii__.metadata[y.getter.name]=y.getter.meta),"undefined"==typeof r[y.setter.name]&&"undefined"!=typeof y.setter.meta&&(y.setter.meta.is_generated=!0,r[y.setter.name]=y.setter.fn,r.__joii__.metadata[y.setter.name]=y.setter.meta);continue}var h=Function('                var args = ["'+p+"\"];                for (var i in arguments) { args.push(arguments[i]); }                return this['super'].apply(this, args);            ");if("function"==typeof u||m.parameters.length>0||"overloads"in d||"overloads"in m)if("overloads"in m&&"object"==typeof m.overloads&&m.overloads.length>1)for(var b=t.Compat.extend(!0,{},m),g=0;g<m.overloads.length;g++)b.parameters=m.overloads[g].parameters,b.is_abstract=m.overloads[g].is_abstract,t.AddFunctionToPrototype(r,b,h,!0);else t.AddFunctionToPrototype(r,m,h,!0);else r[p]=h}}for(var p in o)if(o.hasOwnProperty(p)!==!1){var l=t.ParseClassProperty(p);if("function"!=typeof r[l.name]&&"private"!==l.visibility){var y=t.CreatePropertyGetterSetter(o,l);r[y.getter.name]=y.getter.fn,r.__joii__.metadata[y.getter.name]=y.getter.meta,r[y.setter.name]=y.setter.fn,r.__joii__.metadata[y.setter.name]=y.setter.meta}}return a!==!0&&(r["super"]=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,i=this.__joii__,a=function(e,t,r){if("undefined"==typeof e)throw new Error('Parent method "'+t+'" does not exist.');if("undefined"!=typeof e.__joii__.parent&&"undefined"==typeof e.__joii__.parent[t])return a(e.__joii__.parent,t,r);var o=e.__joii__.parent;if("undefined"==typeof e.__joii__.parent){if("undefined"==typeof e.__api__.__joii__.parent)throw new Error('Method "'+t+"\" does not exist in the parent class. (called using 'super()')");o=e.__api__.__joii__.parent}var s=o[t];n.__joii__=o.__joii__;var f=s.apply(n,r);return n.__joii__=i,f};return a(this,e,t)},r.instanceOf=function(e){"function"==typeof e?e=e.prototype.__joii__.name:"object"==typeof e&&(e=e.__joii__.name);var n=this.__joii__.getInterfaces();for(var i in n)if(n.hasOwnProperty(i)!==!1){if(n[i].prototype.__joii__.name===e)return!0;if(-1!==t.Compat.indexOf(n[i].prototype.__joii__.implementations,e))return!0}if(this.__joii__.name!==e){if("undefined"!=typeof this.__joii__.parent){var a=this,r=this.__joii__.parent;t.Compat.Bind(r.instanceOf,r);var o=r.instanceOf(e);return t.Compat.Bind(r.instanceOf,a),o}return!1}return!0}),r},t.ParseClassProperty=function(e){var n=/\(.*\)/.exec(e.toString());n=null==n?[]:n[0].match(/[^\(,\s\)]+/g),("object"!=typeof n||null===n)&&(n=[]);var i,a=e.toString().replace(/\s?\(.*\)\s?|^\s+|\s+(?=\s)|\s+$/g,"").split(/\s/),r=a[a.length-1],o=t.InternalTypeNames,s=!1,f={name:r,type:null,visibility:"public",is_abstract:!1,is_final:!1,is_nullable:!1,is_read_only:!1,is_constant:!1,is_enum:!1,is_generated:!1,is_joii_object:!1,serializable:!1,parameters:n};if(a.pop(),0===a.length)return f;for(i in a)"undefined"==typeof t.InterfaceRegistry[a[i]]&&"undefined"==typeof t.ClassRegistry[a[i]]&&(a[i]=a[i].toString().toLowerCase());var p=function(e,n,i){"object"!=typeof e&&(e=[e]);for(var a in e)if(e.hasOwnProperty(a)!==!1&&-1!==t.Compat.indexOf(n,e[a]))throw i};for(i in a)switch(a[i]){case"public":p("protected",a,'Property "'+r+'" cannot be both public and protected at the same time.'),p("private",a,'Property "'+r+'" cannot be both public and private at the same time.'),f.visibility="public",s||(f.serializable=!0);break;case"protected":p("public",a,'Property "'+r+'" cannot be both protected and public at the same time.'),p("private",a,'Property "'+r+'" cannot be both protected and private at the same time.'),f.visibility="protected";break;case"private":p("public",a,'Property "'+r+'" cannot be both private and public at the same time.'),p("protected",a,'Property "'+r+'" cannot be both private and protected at the same time.'),f.visibility="private";break;case"abstract":p("final",a,'Property "'+r+'" cannot be both abstract and final at the same time.'),f.is_abstract=!0;break;case"final":p("abstract",a,'Property "'+r+'" cannot be both abstract and final at the same time.'),f.is_final=!0;break;case"nullable":f.is_nullable=!0;break;case"read":case"immutable":f.is_read_only=!0;break;case"serializable":f.serializable=!0,s=!0;break;case"notserializable":f.serializable=!1,s=!0;break;case"const":p(["private","protected","public"],a,"A constant cannot have visibility modifiers."),p("final",a,"A constant cannot be final."),p("abstract",a,"A constant cannot be abstract."),p(["nullable","immutable","read"],a,"A constant cannot be nullable or immutable."),f.is_constant=!0;break;default:if(-1!==t.Compat.indexOf(o,a[i])){if(null!==f.type)throw'Property "'+r+'" has multiple type defintions.';f.type=a[i];break}if("undefined"!=typeof t.InterfaceRegistry[a[i]]){f.is_joii_object=!0,f.type=t.InterfaceRegistry[a[i]].definition.__interface__.name;break}if("undefined"!=typeof t.ClassRegistry[a[i]]){f.is_joii_object=!0,f.type=t.ClassRegistry[a[i]].prototype.__joii__.name;break}if("undefined"!=typeof t.EnumRegistry[a[i]]){f.is_enum=!0,f.type=a[i];break}throw'Syntax error: unexpected "'+a[i]+'" in property declaration of "'+r+'".'}return f},t.CreatePropertyGetterSetter=function(e,n){var i,a,r;"boolean"===n.type?"Is"===t.CamelcaseName(n.name).substr(0,2)?(i=t.CamelcaseName(n.name),i=i.substring(0,1).toLowerCase()+i.substring(1)):i="is"+t.CamelcaseName(n.name):i="get"+t.CamelcaseName(n.name);var o,s,f="set"+t.CamelcaseName(n.name);if("undefined"==typeof e[i]&&(r=new Function('return this["'+n.name+'"];'),a=t.ParseClassProperty(n.visibility+" function "+i),a.visibility=n.visibility,a.is_abstract=n.is_abstract,a.is_final=n.is_final),"undefined"==typeof e[f]&&n.is_read_only===!1){var p,l=n.is_nullable;p="undefined"!=typeof t.InterfaceRegistry[n.type]||"undefined"!=typeof t.ClassRegistry[n.type]?"                        if (JOII.Compat.findJOIIName(v) === '"+n.type+"') {} else {\n                        if (v !== null && typeof (v.instanceOf) !== 'function' || (typeof (v) === 'object' && v !== null && typeof (v.instanceOf) === 'function' && !v.instanceOf('"+n.type+"')) || v === null) {\n                            if ("+l+" === false || ("+l+' === true && v !== null && typeof (v) !== "undefined")) {\n                                throw "'+f+" expects an instance of "+n.type+', " + (v === null ? "null" : typeof (v)) + " given.";\n                            }\n                        }};':"                        if (typeof (JOII.EnumRegistry['"+n.type+"']) !== 'undefined') {                            var _e = JOII.EnumRegistry['"+n.type+"'];                            if (!_e.contains(v)) {                                throw \""+f+': \'" + v + "\' is not a member of enum " + _e.getName() + ".";                            }                        } else {                            if (typeof (v) !== \''+n.type+"') {                                if ("+l+" === false || ("+l+' === true && v !== null && typeof (v) !== "undefined")) {                                    throw "'+f+" expects "+n.type+', " + typeof (v) + " given.";                                }                            };                        }',s=new Function("v",(null!==n.type?p:"")+'this["'+n.name+'"] = v; return this.__api__;'),o=t.ParseClassProperty(n.visibility+" function "+f),o.visibility=n.visibility,o.is_abstract=n.is_abstract,o.is_final=n.is_final}return{getter:{name:i,fn:r,meta:a},setter:{name:f,fn:s,meta:o}}},t.CreateProperty=function(e,t,n,i){try{"undefined"!=typeof Object.defineProperty?Object.defineProperty(e,t,{value:n,enumerable:i===!1,configurable:i!==!1,writable:i!==!1}):e[t]=n}catch(a){e[t]=n}},t.AddFunctionToPrototype=function(e,n,i,a){"undefined"==typeof a&&(a=!1),"object"!=typeof e.__joii__.metadata[n.name]&&(e.__joii__.metadata[n.name]=t.Compat.extend(!0,{},n),e.__joii__.metadata[n.name].overloads=[]);var r=e.__joii__.metadata[n.name];if("object"!=typeof r.overloads&&(r.overloads=[]),r.visibility!==n.visibility)throw"Member "+n.name+": inconsistent visibility.";r.is_abstract=!1;for(var o=0;o<n.parameters.length-1;o++)if("..."==n.parameters[o])throw"Member "+n.name+": Variadic parameter (...) must be the last in the function parameter list.";for(var s=0;s<r.overloads.length;s++){var f=r.overloads[s],p=!1;if(f.is_abstract&&(p=!0),f.parameters.length===n.parameters.length){for(var l=!1,c=0;c<f.parameters.length;c++)f.parameters[c]!=n.parameters[c]&&(l=!0);if(!l){if(!f.is_abstract){if(a)return!1;throw"Member "+n.name+"("+n.parameters.join(", ")+") is defined twice."}r.overloads.splice(s,1),s--,p=!1}}p&&(r.is_abstract=!0)}var _={fn:i,parameters:n.parameters,is_abstract:n.is_abstract};return e.__joii__.metadata[n.name].overloads.push(_),_.is_abstract&&(e.__joii__.metadata[n.name].is_abstract=!0),e[n.name]=t.CreateFunctionShim(n.name,e.__joii__.metadata[n.name].overloads),!0},t.CreateFunctionShim=function(e,n){return function(){if(1===n.length&&0===n[0].parameters.length)return n[0].fn.apply(this,arguments);for(var i=null,a=0,r=0;r<n.length;r++){var o=n[r],s=o.parameters,f=!0;if(s.length==arguments.length){for(var p=0;p<s.length;p++)if(!t.Compat.canTypeBeCastTo(arguments[p],s[p])){f=!1;break}if(f)return o.fn.apply(this,arguments)}if("..."==s[s.length-1]){f=null;for(var l=0,p=0;p<s.length;p++)if("..."===s[p])f=!0;else{if(!t.Compat.canTypeBeCastTo(arguments[p],s[p])){f=!1;break}l++}f&&l>a&&(i=o,a=l)}}if(null!=i){for(var c=[],p=i.parameters.length-1;p<arguments.length;p++)c.push(arguments[p]);return arguments.length=i.parameters.length,arguments[i.parameters.length-1]=c,i.fn.apply(this,arguments)}for(var _=[],p=0;p<arguments.length;p++){var u=t.Compat.findJOIIName(arguments[p]);u||(u=typeof arguments[p]),_.push(null===u?typeof arguments[p]:u)}throw"Couldn't find a function handler to match: "+e+"("+_.join(", ")+")."}},t.CamelcaseName=function(e){return e=e.toLowerCase().replace(/_(.)/g,function(e,t){return t.toUpperCase()}),e.charAt(0).toUpperCase()+e.slice(1)},t="undefined"!=typeof t?t:{},t.ClassRegistry={},t.ClassBuilder=function(){function e(){var n=function(){};n.prototype=this;var i=new n,a={};if(i=t.Compat.extend(!0,{},i),"undefined"!=typeof this&&(t.CreateProperty(i,"__joii__",this.__joii__),t.CreateProperty(a,"__joii__",this.__joii__)),"undefined"!=typeof this&&"object"==typeof this.__joii__){if(this.__joii__.is_abstract===!0)throw"An abstract class cannot be instantiated.";for(var o in this){var s=i.__joii__.metadata[o];if(s&&"overloads"in s){for(var f in s.overloads)if(s.overloads[f]&&s.overloads[f].is_abstract===!0)throw"Missing abstract member implementation of "+o+"("+s.overloads[f].parameters.join(", ")+")"}else if(s&&s.is_abstract===!0)throw'Missing abstract member implementation of "'+o+'".';"function"!=typeof i[o]||"undefined"!=typeof s&&"public"!==s.visibility||"__call"===o||(a[o]=t.Compat.Bind(i[o],i))}}if("undefined"==typeof this||"undefined"==typeof this.__joii__){for(var p in t.Config.callables)if(t.Config.callables.hasOwnProperty(p)&&"function"==typeof e.prototype[t.Config.callables[p]]){var l=e.prototype[t.Config.callables[p]].apply(r,arguments);if(l===r)throw t.Config.callables[p]+" cannot return itself.";return l}throw"This class cannot be called as a function because it's lacking the __call method."}if(i.__api__=a,"undefined"!=typeof i.__joii__.parent)for(var c=i.__joii__.parent;"undefined"!=typeof c;)c.__api__=a,c=c.__joii__.parent;for(var p in t.Config.constructors)if(t.Config.constructors.hasOwnProperty(p)){var _=t.Config.constructors[p];if("function"==typeof i[_]){i[_].apply(i,arguments);break}}if(1==arguments.length&&"object"==typeof arguments[0]&&"__joii_deserialize_object"in arguments[0]&&i.deserialize(arguments[0].data),this.__joii__.is_abstract)throw"Cannot instantiate abstract class "+this.__joii__.name;return a}var n=t.Compat.ParseArguments(arguments),i=n.name,a=n.parameters,r=n.body;e.prototype=t.PrototypeBuilder(i,a,r,!1);for(var o in e.prototype.__joii__.constants)t.CreateProperty(e,o,e.prototype.__joii__.constants[o],!1);if("string"==typeof a["enum"]){var s=t.EnumBuilder(a["enum"],e);if(a.expose_enum===!0){var f="object"==typeof window?window:global;if("undefined"!=typeof f[a["enum"]])throw'Cannot expose Enum "'+a["enum"]+'" becase it already exists in the global scope.';f[a["enum"]]=s}}var p=arguments[0];if(e.toString=function(){return"string"==typeof p?"[class "+p+"]":"[class Class]"},e.prototype.__joii__.interfaces=a["implements"],e.prototype.__joii__.getInterfaces=t.Compat.Bind(function(){var e=[],n=t.Compat.Bind(function(e){if("function"==typeof e)return e;if("string"==typeof e){if("undefined"==typeof t.InterfaceRegistry[e])throw'Interface "'+e+'" does not exist.';return t.InterfaceRegistry[e]}},this);if("undefined"!=typeof this.parent&&"undefined"!=typeof this.parent.__joii__&&(e=this.parent.__joii__.getInterfaces()),"undefined"!=typeof this.interfaces)if("object"==typeof this.interfaces)for(var i in this.interfaces)this.interfaces.hasOwnProperty(i)&&e.push(n(this.interfaces[i]));else e.push(n(this.interfaces));return e},e.prototype.__joii__),a["abstract"]!==!0){var l=e.prototype.__joii__.getInterfaces();for(var c in l)l.hasOwnProperty(c)&&"function"==typeof l[c]&&l[c](e)}if(!("serialize"in e.prototype.__joii__.metadata)||"overloads"in e.prototype.__joii__.metadata.serialize&&(e.prototype.__joii__.metadata.serialize.overloads[0].parameters.length>0||e.prototype.__joii__.metadata.serialize.overloads.length>1)){var _=function(e){var t={__joii_type:this.__joii__.name};for(var n in this.__joii__.metadata){var i=this.__joii__.metadata[n];i.serializable&&(i.is_joii_object&&!i.is_enum&&"object"==typeof this[i.name]&&null!=this[i.name]?t[i.name]=JSON.parse(this[i.name].serialize()):t[i.name]=this[i.name])}return JSON.stringify(t)},u=t.ParseClassProperty("public function serialize()");t.AddFunctionToPrototype(e.prototype,u,_,!0)}if(!("deserialize"in e.prototype.__joii__.metadata)||"overloads"in e.prototype.__joii__.metadata.deserialize&&(e.prototype.__joii__.metadata.deserialize.overloads[0].parameters.length>0||e.prototype.__joii__.metadata.deserialize.overloads.length>1)){var _=function(e){this.deserialize(JSON.parse(e))},m=t.ParseClassProperty("public function deserialize(string)");t.AddFunctionToPrototype(e.prototype,m,_,!0),_=function(e){for(var n in this.__joii__.metadata){var i=this.__joii__.metadata[n];if(i.serializable&&i.name in e&&"function"!=typeof e[i.name])if("object"==typeof e[i.name]&&null!=e[i.name]&&"__joii_type"in e[i.name]){var a=e[i.name].__joii_type;if("undefined"!=typeof t.InterfaceRegistry[a])throw"Cannot instantiate an interface.";if("undefined"==typeof t.ClassRegistry[a])throw"Class "+a+" not currently in scope!";this[i.name]=t.ClassRegistry[a].deserialize(e[i.name])}else this[i.name]=e[i.name]}},m=t.ParseClassProperty("public function deserialize(object)"),t.AddFunctionToPrototype(e.prototype,m,_,!0)}if(e.deserialize=function(t){var n={__joii_deserialize_object:!0,data:t};return new e(n)},"undefined"!=typeof t.ClassRegistry[i])throw'Another class named "'+i+'" already exists.';return t.ClassRegistry[i]=e,e.prototype=t.Compat.extend(!0,{},e.prototype),e},t="undefined"!=typeof t?t:{},t.InterfaceRegistry={},t.InterfaceBuilder=function(){var e=t.Compat.ParseArguments(arguments),n=e.name,i=e.parameters,a=e.body,r=t.PrototypeBuilder(n,i,a,!0),o=function(e){var n,i,a,r=new t.Reflection.Class(e),o=this.reflector.getProperties(),s=this.reflector.getMethods();if(r.isAbstract())return!0;var f=function(e,t,n,i){if(t.getVisibility()!==n.getVisibility())throw i+" "+n.getName()+" cannot be "+n.getVisibility()+" because the interface declared it "+t.getVisibility()+".";if("Method"!=i){if(t.getType()!==n.getType())throw i+" "+n.getName()+" cannot be declared as "+n.getType()+" because the interface declared it as "+t.getType()+".";if(t.isNullable()!==n.isNullable())throw i+" "+n.getName()+" must be nullable as defined in the interface "+e.name+"."}return!0};for(n in o)if(o.hasOwnProperty(n)!==!1){if(i=o[n],!r.hasProperty(i.getName()))throw"Class must implement "+i.toString().split(":")[0]+" as defined in the interface "+this.name+".";a=r.getProperty(i.getName()),f(this,i,a,"Property")}for(n in s)if(s.hasOwnProperty(n)!==!1){if(i=s[n],!r.hasMethod(i.getName()))throw"Class must implement "+i.toString().split(":")[0]+" as defined in the interface "+this.name+".";a=r.getMethod(i.getName()),f(this,i,a,"Method");var p=i.getParameters(),l=a.getParameters();if(0==p.length||"object"!=typeof p[0]){if(i.getParameters().length!==a.getParameters().length)throw"Method "+i.getName()+" does not match the parameter count as defined in the interface "+this.name+"."}else for(var c=0;c<p.length;c++){for(var _=p[c],u=!0,m=0;m<l.length;m++){var d=l[m];if(_.parameters.length===d.parameters.length){u=!1;for(var y=0;y<functionParametersMeta.parameters.length;y++)functionParametersMeta.parameters[j]!=d.parameters[y]&&(u=!0);if(!u)break}}if(u)throw"Method "+i.getName()+" does not match the parameter count as defined in the interface "+this.name+"."}}};t.CreateProperty(o,"__interface__",{prototype:r,reflector:new t.Reflection.Class(r),name:n}),t.CreateProperty(o,"__joii__",r.__joii__);var s=t.Compat.Bind(o,o.__interface__);s.prototype=r;var f,p=o.__interface__.reflector.getProperties(),l=o.__interface__.reflector.getMethods(),c=function(e,t){if(e.isAbstract())throw"An interface may not contain abstract definitions. "+t+" "+e.getName()+" is abstract in interface "+o.__interface__.name+".";if(e.isFinal())throw"An interface may not contain final definitions. "+t+" "+e.getName()+" is final in interface "+o.__interface__.name+"."};for(f in p)p.hasOwnProperty(f)!==!1&&c(p[f],"Property");for(f in l)l.hasOwnProperty(f)!==!1&&c(l[f],"Method");if(t.CreateProperty(s,"definition",o),"undefined"!=typeof t.InterfaceRegistry[n])throw'Another interface with the name "'+n+'" already exists.';if(-1!==t.Compat.indexOf(t.InternalTypeNames,n))throw'An interface may not be named "'+n+'", becase that name is reserved.';var _={};for(f in r.__joii__.constants)r.__joii__.constants.hasOwnProperty(f)!==!1&&(t.CreateProperty(s,f,r.__joii__.constants[f],!1),_[f]=r.__joii__.constants[f]);if("string"==typeof i["enum"]){var u=t.EnumBuilder(i["enum"],_);if(i.expose_enum===!0){var m="object"==typeof window?window:global;if("undefined"!=typeof m[i["enum"]])throw'Cannot expose Enum "'+i["enum"]+'" becase it already exists in the global scope.';m[i["enum"]]=u}}return t.InterfaceRegistry[n]=s,s},t="undefined"!=typeof t?t:{},t.EnumRegistry={},t.EnumBuilder=t.ClassBuilder({"final":!0},{"public immutable string name":null,"public immutable object constants":{},__construct:function(e,t){this.name=e,this.constants=t},contains:function(e){for(var t in this.constants)if(this.constants.hasOwnProperty(t)!==!1&&this.constants[t]===e)return!0;return!1},__call:function(e,n){if("string"!=typeof e)throw"Argument #1 of Enum must be a string, "+typeof e+" given.";if("function"==typeof n&&"undefined"!=typeof n.prototype.__joii__&&(n=n.prototype.__joii__.constants),"object"!=typeof n)throw"Argument #2 of Enum must be an object or definition, "+typeof n+" given.";if("undefined"!=typeof t.EnumRegistry[e.toLowerCase()])throw'Enumerator "'+e+'" already exists.';var i=new t.EnumBuilder(e,n);for(var a in n){if("function"==typeof n[a])throw'An enumerator cannot contain functions. "'+a+'" is a function.';if("object"==typeof n[a])throw'An enumerator cannot contain objects. "'+a+'" is an object.';t.CreateProperty(i,a,n[a],!1)}return t.EnumRegistry[e.toLowerCase()]=i,i}}),t="undefined"!=typeof t?t:{},t.Reflection={},t.Reflection.Class=t.ClassBuilder({},{"protected immutable object meta":null,"protected immutable object proto":null,"public immutable object parent":null,"protected __construct":function(e){if("function"==typeof e&&(e=e.prototype),"object"!=typeof e||"object"!=typeof e.__joii__)throw"Reflection.Class requires a JOII-created definition.";this.proto=e,this.meta=e.__joii__,"undefined"!=typeof this.meta.parent&&(this.parent=new t.Reflection.Class(this.meta.parent))},"public getName":function(){return this.meta.name},"public isAbstract":function(){return this.meta.is_abstract===!0},"public hasProperty":function(e){var t=this.getProperties();for(var n in t)if(t[n].getName()===e)return!0;return!1},"public hasParent":function(){return null!==this.parent},"public getParent":function(){return this.parent},"public getMethods":function(e){var n=[];for(var i in this.proto)"function"==typeof this.proto[i]&&-1===t.Compat.indexOf(t.InternalPropertyNames,i)&&n.push(new t.Reflection.Method(this,i));return n},"public hasMethod":function(e){var t=this.getMethods();for(var n in t)if(t[n].getName()===e)return!0;return!1},"public getMethod":function(e){var t=this.getMethods();for(var n in t)if(t[n].getName()===e)return t[n];throw'Method "'+e+'" does not exist.'},"public getProperties":function(e){var n=[];for(var i in this.proto)"function"!=typeof this.proto[i]&&-1===t.Compat.indexOf(t.InternalPropertyNames,i)&&n.push(new t.Reflection.Property(this,i));return n},"public getProperty":function(e){var t=this.getProperties();for(var n in t)if(t[n].getName()===e)return t[n];throw'Property "'+e+'" does not exist.'}}),t.Reflection.Property=t.ClassBuilder({},{"protected nullable object reflector":null,"protected nullable object meta":null,"public read string name":null,"protected __construct":function(e,t){this.reflector=e,this.name=t,this.meta=e.getMeta().metadata[t],"undefined"==typeof this.meta&&(this.meta={name:this.name,type:null,visibility:"public",is_nullable:!1,is_abstract:!1,is_read_only:!1,is_final:!1}),null===this.meta.type&&this.meta.is_nullable===!1&&(this.meta.type=typeof this.reflector.getProto()[this.meta.name])},"public getType":function(){return this.meta.type},"public isAbstract":function(){return this.meta.is_abstract},"public isNullable":function(){return this.meta.is_nullable},"public isFinal":function(){return this.meta.is_final},"public isPrivate":function(){return"private"===this.meta.visibility},"public isProtected":function(){return"protected"===this.meta.visibility},"public isPublic":function(){return"public"===this.meta.visibility},"public isImmutable":function(){return this.meta.is_read_only},"public isConstant":function(){return this.meta.is_constant},"public isType":function(e){return e===this.meta.type},"public getVisibility":function(){return this.meta.visibility},toString:function(){var e=[],t=this.reflector.getProto()[this.name],n="",i="";return this.meta.is_abstract&&e.push("abstract"),this.meta.is_final&&e.push("final"),e.push(this.meta.visibility),this.meta.is_nullable&&e.push("nullable"),this.meta.is_read_only&&e.push("read"),null===this.meta.type?null===t?e.push("mixed"):e.push(typeof t):e.push(this.meta.type),e.push('"'+this.meta.name+'"'),n=e.join(" "),i="function"==typeof t?"[Function]":"object"==typeof t&&null!==t?"[Object ("+t.length+")]":"string"==typeof t?'"'+t+'"':t,n+": "+i}}),t.Reflection.Method=t.ClassBuilder({"extends":t.Reflection.Property},{"public getParameters":function(){var e=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,t=/,/,n=/^\s*(_?)(\S+?)\1\s*$/,i=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,a=function(a){var r,o,s=[];r=a.toString().replace(i,""),o=r.match(e);var f=o[1].split(t),p=function(e,t,n){s.push(n)};for(var l in f){var c=f[l];c.replace(n,p)}return s},r=this.reflector.getProto(),o=r.__joii__.metadata[this.name].overloads;if(o&&0!==o.length){if(1===o.length&&0===o[0].parameters.length)return a(o[0].fn);for(var s=[],f=0;f<o.length;f++){for(var p=[],l=o[f],c=a(l.fn),_=0;_<l.parameters.length;_++){var u={name:c.length>_?c[_]:null,type:l.parameters[_]};p.push(u)}s.push(p)}return s}return a(this.reflector.getProto()[this.name])},"public getBodyAsString":function(e){var t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=this.reflector.getProto()[this.name].toString().replace(t,"");return n.substr(n.indexOf("{")+1,n.lastIndexOf("}")-4).replace(/}([^}]*)$/,"$1")},"public usesVariadicArguments":function(){var e=this.reflector.getProto()[this.name].toString();
return e.match(/[\(|\.|\ ](arguments)[\)|\.|\,|\ |]/g)},toString:function(){var e=this["super"]("toString").split(":")[0],t="[Function",n=this.getParameters(),i=this.usesVariadicArguments();if(n.length>0&&"object"==typeof n[0])for(var a=0;a<n.length;a++){var r=n[a];t+=" (";for(var o=!0,s=0;s<r.length;s++)o||(t+=", "),o=!1,t+=r[s].type,null!==r[s].name&&(t+=" "+r[s].name,i=!0);var f=this.reflector.getProto().__joii__.metadata[this.name].overloads[a].fn.toString();i=f.match(/[\(|\.|\ ](arguments)[\)|\.|\,|\ |]/g),i&&(t+=", ..."),t+=")\n"}else n.length>0?(t+=" ("+n.join(", "),i&&(t+=", ..."),t+=")"):0===n.length&&i&&(t+=" (...)");return t+="]",e+": "+t}}),e.JOII=t,e.Class=t.ClassBuilder,e.Interface=t.InterfaceBuilder,e.Enum=t.EnumBuilder,e.useGlobal=function(){var t="object"==typeof window?window:global;for(var n in e)e.hasOwnProperty(n)!==!1&&(t[n]=e[n])}});